\documentclass[a4paper, twoside]{report}

%-------------------------------------

% Document type
\usepackage{tgsreqspec}
%\usepacakge(tgstechspec}
%\usepackage{tgstechnote}
%\usepackage{tgsproc}
%\usepackage{tgsguidelines}
%\usepackage{tgstestplan}

% Document information
\documentreference{RS-0007}
\projectcode{DMAC}
\documentmajorversion{1}
\documentminorversion{A}
\clientcode{TGS}
\documentauthor{\persons{DEL}{}}
\documentcontroller{\persons{RAC}{}}
\documentquality{\persons{DOC}{}}
\title{CAMP Property Editor}
\date{\today}

% Contractual document ?
%\contractualdocument
\notcontractualdocument

% Document status
%\draftdocument
\underapprovaldocument
%\publisheddocument
%\obsoletedocument

% Document classification
%\publicdocument
%\restricteddocument
\confidentialdocument

% Generate PDF information
\makepdfinfo

%-------------------------------------

\begin{document}

\maketitle

\chapter*{About this document}

\section*{Document history}

% To add a history entry use:
% \addhistory{version}{data}{author}{changes}
% Newer history entries first
\begin{historytable}
\end{historytable}

\section*{Related documents}

% To add a related document entry use:
% \adddocument{document}{version}{parts}{knowledge}
% document: the document reference, title, url...
% version: version of the document if any
% parts: parts of the document which is relevant (pages, sections...)
% knowledge: should be either "Required", or "Recommanded", or "Advised"
\begin{documenttable}
    \adddocument{CAMP RS-0001}{1.A}{}{Required}
\end{documenttable}

\tableofcontents

%-------------------------------------

\chapter{Introduction\label{sec:introduction}}

The CAMP Property Editor is a graphical component that allows viewing and editing CAMP properties. The
component is designed to be embedded into an application that allows easy interaction with CAMP
objects.

The property editor is extendable to allow custom display and edit features according to CAMP property
types.

This document specifies the requirements for the CAMP Property Editor.

\chapter{Description of needs\label{sec:needs}}

Here is an unordered list of needs for the CAMP Property Editor component.

\begin{itemize}
    \item Based on Qt
    \item Allow synchronous viewing and editing of properties
    \item Request property values only when needed
    \item Allow user cancellation of editing operations
    \item Handle clean and dirty states:
    \begin{itemize}
        \item Clean state corresponds typically to the state of the object the last time it was saved
        \item Dirty state may correspond to an object that has been modified since the last time it
was saved; the modified properties must be emphasized
    \end{itemize}
    \item Handle all CAMP property types
    \item Allow customization/extension of property viewers and editors
    \item Allow to group properties according to the class hierarchy
    \item Allow property filtering by property name and by tag name using regular expressions
    \item Ease a future implementation of editing the common properties of several objects inheriting a same base class
    \item Ease a future implementation of an asynchronous viewing and editing mode
    \item Ease a future implementation to receive external notification of property changes
\end{itemize}

\chapter{Overview\label{sec:overview}}

The CAMP Property Editor shows the CAMP properties of a CAMP object in a manner similar to the Qt
designer property editor which does it for Qt properties (fig. \ref{fig:qt-property-editor}).

\image[0.5]{fig:qt-property-editor}{Qt Designer Property Editor}{images/qt_property_editor}

The editor widget must be composed of two main parts:
\begin{itemize}
    \item A tree like structure displaying the property names in a first column. This column
contains usually the property names.
    \item A second column displaying the associated values and allows to edit them. This column
contains usually the property values.
\end{itemize}

Thus, each row of the tree correspond, usually, to one property. The first cell of that row is the
\emph{property name area} of the property while the cell in the second column is the \emph{property
value area}.

The property names and values displaying and editing features can be fully customized as explained
later. This means that the property name area can display an other thing than the property name, and
the property value area can display an other thing than the corresponding property value. The
section \ref{sec:property_types} details the different viewers and editors for all
supported CAMP property types.

\section{Filtering and grouping}

The property editor must display all visible properties of a CAMP object. Moreover, it must be possible
to filter the properties according to their names or their tag names using regular expressions.

The property editor must allow to group the properties of a CAMP object according to the class
hierarchy of the object. The figures \ref{fig:without-classes} and \ref{fig:with-classes} show an
example of a CAMP object being displayed by the CAMP property editor with and without grouping. In
the first case, there is no classes information. Each sub-tree directly lists all the properties of the
corresponding CAMP object. In the second case, all the properties are placed under the meta-class
name in which they have been declared. This allows to group properties from the most general sub-set to the
most specific one.

\image[0.5]{fig:without-classes}{Simple property tree}{images/without_classes}
\image[0.5]{fig:with-classes}{Property tree with classes hierarchy}{images/with_classes}

\section{Displaying and editing properties}

\ibinfo{
A cell can be in two states: either in view mode, or in edit mode. View mode refers to a state that
only displays something, but does not allow the user to interact with it. Edit mode refers to a state
that allows some interaction with the user. Typically, a cell is in the view mode by default and
enters in edit mode according to a user action. Then, an editor is shown allowing the user to change
the cell value. When the user validates the changes, the cell returns to the view state.

However, a cell can be in edit mode all the time. Thus, the viewer is never shown and only the
editor is. This is useful for example to display a boolean value as a checkbox. This way, the user
can directly click on it to change the value. An other example would be a combox in the name area
that allows the iteration over the element of an array, the current value being displayed in the value
area.
}

According to the property type, the property name area and the property value area must be fully
customizable (i.e. property name and value viewers and editors).

Moreover, a future version of the property editor will allow to edit the values asynchronously. This
means that the property editor will send a request for a value and will receive it later. The property
editor must show a busy indicator while the value is missing. The user must not be able to interact
with editor while the property editor is busy. The current implementation must take this future
improvement into account.

Property values must be requested only when necessary. This means that a property which is not visible
must not ask its value to the underlying CAMP object. The value must be retrieved when the property
becomes visible.

Passing from the view mode to the edit mode must be done according to a global policy selected
programatically. A \emph{simple click} and a \emph{double click} policies must be available. These
policies must activate the edit mode of a cell when the user makes a simple click (respectively a
double click) on this cell. An \emph{F2 key} policy must be available too. This must edit the
current selected cell if the user press the \emph{F2 key}. Combining mouse and keyboard policies
must be possible.

When a property is edited, the user must be able to cancel the operation at any time by
pressing the escape key. Thus, the property value is left unchanged.

The CAMP property editor must provide a way to mark a property as clean or dirty. Dirty properties must be
emphasized. This way, the user can easily see what is dirty and what is not.

The displaying and editing of several CAMP objects at the same time will be present in a future
version. In this case, the CAMP property editor must list all the properties of their first common
meta-class ancestor. Thus, if the objects do not inherit a same base class, no property will be
listed. This feature is not required for now, but it must be taken into account.

\chapter{Handling property types\label{sec:property_types}}

This section will define how the different CAMP property types will be handled by default. This
includes the definition of the viewers and editors for the property name and value areas for each
property type.

\section{Default}

This section define how property with unsupported or unknown types are handled.

The property name area must display the property name as a simple text. If the property is dirty, the
text must be displayed in bold.

If the property value is convertible into a string, this representation must be used into the
property value area. Otherwise, the text \emph{not available} must be displayed in italic. If the
property is not readable, the cell must be left empty.

The property name and value must not be editable (thus, the content of the area must be grayed).

\section{Boolean}

The property name area must display the property name as a simple text. If the property is dirty,
the text must be displayed in bold.

The property value is displayed and edited with a check box.

If the property has a tag named \emph{trueLabel}, the string representation of the associated value
must be displayed along the checkbox when the property is true.
If the property has a tag named \emph{falseLabel}, the string representation of the associated value
must be displayed along the checkbox when the property is false.

\section{Integer}

The property name area must display the property name as a simple text. If the property is dirty,
the text must be bolded.

The string representation of the integer must be used as the property value area viewer.
The property area editor is a spin box for integer number.

If the property has a tag named \emph{min}, the integer representation of the associated value must
be used as lower bound for the spin box.
If the property has a tag named \emph{max}, the integer representation of the associated value must
be used as upper bound for the spin box. The value must be changed each time an arrow is pressed.

\section{Real}

The property name area must display the property name as a simple text. If the property is dirty,
the text must be bolded.

The string representation of the real number must be used as the property value area viewer.
The property area editor is a spin box for real number. The value must be changed each time an arrow
is pressed.

If the property has a tag named \emph{min}, the real number representation of the associated value must be used as lower bound for the spin box.
If the property has a tag named \emph{max}, the real number representation of the associated value must be used as upper bound for the spin box.

\section{String}

The property name area must display the property name as a simple text. If the property is dirty,
the text must be bolded.

The editor is a line edit.

If the property has a tag named \emph{validator}, the string representation of the associated value
must be used to validate the value entered into the line edit while the user types in. The validator
is used as regular expression in the QRegExp::RegExp2 Qt syntax (see the Qt's QRegExp
documentation). If the current string validates the regexp, the background of the line edit must be
green, otherwise it must be red.

\section{Enumeration}

The property name area must display the property name as a simple text. If the property is dirty,
the text must be bolded.

The property value viewer must display the string representation of the current value.
The property value editor is a combo-box which displays the string representation of all the
possible values (i.e. enumeration labels).

\section{Object}

The property name area must display the property name as a simple text. If the property is dirty,
the text must be bolded.

The property value area displays the string representation of the object if it exists.
There is no editor. Instead, the properties of the object are listed in a sub-tree as usual.

\section{Array}

Array properties handling must offers two different ways to see the array content:
\begin{description}
    \item[Collapsed mode (default)] In this mode, the array must be displayed in a space-saving way,
showing only one element at a time, but allowing to iterate over each one easily
    \item[Expanded mode] In this mode, the whole array content must be displayed which offers a
global view of the array content.
\end{description}

The default mode must be the collapsed one as it is space preserving and it avoids querying all the
array values which could be expensive.

The figures \ref{fig:simple-array}, \ref{fig:object-array} and \ref{fig:sub-array} gives an idea of
what is expected in terms of layout and feature. Each figure contains an overview of an array shown
in the collapsed mode (on the left) and in the expanded mode (on the right) according to array
element type.

\subsection{Simple array\label{sec:array-simple}}

The figure \ref{fig:simple-array} illustrates how must be represented arrays containing simple
elements (i.e. neither object nor sub-array).

The collapsed mode must display the property name (in bold if the array is dirty) with a spinbox and
a push-button in the property name area. The spinbox must allow to iterate
over each element of the array, the corresponding value being displayed in the property value area
as usual. If the array is empty, the spinbox must be grayed. The push-button must pop up a
drop-down list with different items as explained in section \ref{sec:array-dropdownlist}.

The expanded mode must display the property name (in bold if the array is dirty) with a push-button
in the property name area. The push-button must pop up a drop-down list with different items as
explained in section \ref{sec:array-dropdownlist}. The elements of the array must be listed in a
sub-tree, each node representing an element. The property name area must display the element
index, and the corresponding value must be displayed in the property value area as usual. Dynamic
arrays have additional buttons/items as explained in the section \ref{sec:array-dynamic}.

\image[0.5]{fig:simple-array}{Array with simple elements}{images/simple_array}

\subsection{Array of objects\label{sec:array-object}}

The figure \ref{fig:object-array} illustrates how must be represented arrays containing object
elements.

The representation must be similar to the one used for simple array (section
\ref{sec:array-simple}). The difference is that an additional sub-tree must list the properties of the
current object in collapsed mode, and the properties of the object corresponding to the matching
item for the expanded mode.

\image[0.5]{fig:object-array}{Array with object elements}{images/object_array}

\subsection{Array of arrays\label{sec:array-subarray}}

The figure \ref{fig:sub-array} illustrates how must be represented arrays containing array elements
(i.e. sub-array).

The representation must be similar to the one used for simple array (section
\ref{sec:array-simple}). The difference is that the property value area of the array must be left
blank. Sub-arrays must be listed in a sub-tree with the usual representation. This means that
sub-arrays can be in collapsed or expanded mode too.

\image[0.5]{fig:sub-array}{Array with arrays elements}{images/sub_array}

\subsection{Drop-down list\label{sec:array-dropdownlist}}

The property name area of an array node must contain a push-button that displays a drop-down list
when clicked on. This drop-down list must have an item allowing the user to switch between the collapsed and
the expanded modes. In the future, an item will allow to display a specialized dialog to view and
edit the array.

\subsection{Dynamic array\label{sec:array-dynamic}}

Dynamic arrays allow to insert and remove elements. The property editor must provide an access to
these features. Thus, for arrays in collapsed mode, the drop-down list must display:
\begin{itemize}
    \item An item to insert an element before the current index
    \item An item to insert an element after the current index
    \item An item to remove the current element
\end{itemize}

For dynamic arrays in expanded mode, these features must be accessible directly on the property name
area of each element. A push button must allow to insert an element before the clicked one, another
one must allow to remove the clicked element. An additional node at the end of the subtree must contain a push button to insert an element at the end of the array.

\end{document}

